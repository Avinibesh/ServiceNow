<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>public</access>
        <active>true</active>
        <api_name>x_wopa_inbound_act.inbound_action</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description/>
        <name>inbound_action</name>
        <script><![CDATA[var inbound_action = Class.create();
inbound_action.prototype = {
    initialize: function() {},

    isinboundaction: function(mail, cc, mailfrom, subject) {
        //gs.info("ADEY in action"+mail+cc+mailfrom+subject);
		// var user = "";
		// var usr = new GlideRecord('sys_user');
		// usr.addEncodedQuery('sys_id='+userID);
		// usr.query();
		// if(usr.next())
		// {
		// 	user = usr.email;
		// }
        var mapping = new GlideRecord('x_wopa_inbound_act_u_inbound_mapping');
        mapping.addEncodedQuery('fromIN' + mail + ',' + cc + ',' + mailfrom + '^subjectSTARTSWITH' + subject);
        mapping.query();
        if (mapping.next()) {
            return true;
        }
        return false;
    },

    createtask: function(mail, cc, mailfrom, subject, bodytest) {
        var mapping = new GlideRecord('x_wopa_inbound_act_u_inbound_mapping');
        mapping.addEncodedQuery('fromIN' + mail + ',' + cc + ',' + mailfrom + '^subjectSTARTSWITH' + subject);
        mapping.query();
        if (mapping.next()) {
            current.contact_type = "email";
			var incident = new GlideRecord('incident');
			incident.initialize();
            incident.business_service = mapping.service;
            incident.service_offering = mapping.service_offering;
            incident.caller_id = "5136503cc611227c0183e96598c4f706";
            incident.opened_by = "5136503cc611227c0183e96598c4f706";
            incident.impact = mapping.impact;
            incident.urgency = mapping.urgency;
            incident.cmdb_ci = mapping.configuration_item;
            incident.assignment_group = mapping.assignment_group;
            incident.assigned_to = mapping.assigned_to;
            incident.short_description = mapping.short_description;
            incident.description = mapping.description;
            incident.state = '1';
			incident.insert();
            var sysid = incident.sys_id;
            
			mapping.map_body_to_field = bodytest;
            mapping.update();
            return sysid;
        }
        return false;
    },

    type: 'inbound_action'
};]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>avinibesh.Dey</sys_created_by>
        <sys_created_on>2024-06-26 10:13:10</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>d5b649991bc3ca50547a37ff034bcb2f</sys_id>
        <sys_mod_count>8</sys_mod_count>
        <sys_name>inbound_action</sys_name>
        <sys_package display_value="Inbound Actions" source="x_wopa_inbound_act">de2ddf63dbf2cad0e3986d8d139619e7</sys_package>
        <sys_policy>read</sys_policy>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Inbound Actions">de2ddf63dbf2cad0e3986d8d139619e7</sys_scope>
        <sys_update_name>sys_script_include_d5b649991bc3ca50547a37ff034bcb2f</sys_update_name>
        <sys_updated_by>avinibesh.Dey</sys_updated_by>
        <sys_updated_on>2024-06-26 13:47:24</sys_updated_on>
    </sys_script_include>
</record_update>
